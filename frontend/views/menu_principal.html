<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VigilaCore | Dashboard </title>
    <link rel="stylesheet" href="../css/v2_modern.css">
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
 <style>
    /* ===== ESTRUTURA GLOBAL (MENU / HEADER / FOOTER) ===== */

    .v2-icon-btn{
        width:34px;
        height:34px;
        display:inline-flex;
        align-items:center;
        justify-content:center;
        border:1px solid var(--v2-border);
        background: rgba(255,255,255,0.02);
        color: var(--v2-text-dim);
        border-radius: 12px;
        cursor:pointer;
        transition: opacity .15s ease, transform .15s ease;
    }

    .v2-icon-btn:hover{
        opacity: 0.9;
        transform: translateY(-1px);
    }

    .v2-icon-btn i{
        width:18px;
        height:18px;
    }

    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }

    /* Responsividade básica do layout principal */
    @media (max-width: 1200px) {
        .v2-content {
            min-width: 0;
        }
    }
</style>

<script src="../js/sidebar_toggle.js"></script>
</head>
<body>
    <div class="v2-container">
        <!-- SIDEBAR -->
        <aside class="v2-sidebar">
            <div class="v2-logo-section">
                <button id="v2-sidebar-toggle" class="v2-sidebar-toggle" type="button" title="Minimizar menu" aria-label="Minimizar menu"><i data-lucide="panel-left"></i></button>
                <div class="v2-logo-text v2-brand-text"><span class="logo-vigila">Vigila</span><span class="logo-core">Core</span></div>
            </div>

            <nav class="v2-nav">
                <a href="menu_principal.html" class="v2-nav-item active" data-title="Menu Principal">
                    <i data-lucide="globe"></i>
                    <span class="v2-nav-text">Menu Principal</span>
                </a>
                <a href="releitura.html" class="v2-nav-item" data-title="Releituras">
                    <i data-lucide="refresh-cw"></i>
                    <span class="v2-nav-text">Releituras</span>
                </a>

                <a href="porteira.html" class="v2-nav-item" data-title="Porteira">
                    <i data-lucide="door-open"></i>
                    <span class="v2-nav-text">Porteira</span>
                </a>

                <div class="v2-nav-divider"></div>
                <div class="v2-nav-section-label">Em breve</div>

                <a href="relatorios.html" class="v2-nav-item" data-title="Relatórios">
                    <i data-lucide="file-text"></i>
                    <span class="v2-nav-text">Relatórios</span>
                </a>
                <a href="ia.html" class="v2-nav-item" data-title="Análise IA">
                    <i data-lucide="brain"></i>
                    <span class="v2-nav-text">Análise IA</span>
                </a>
               <a href="usuario.html" class="v2-nav-item" data-title="Área do Usuário">
                    <i data-lucide="circle-user-round"></i>
                    <span class="v2-nav-text">Área do Usuário</span>
                </a>
                <a href="administracao.html" class="v2-nav-item" data-title="Administração">
                    <i data-lucide="settings"></i>
                    <span class="v2-nav-text">Administração</span>
                </a>
                <a href="login.html" class="v2-nav-item v2-nav-logout" data-title="Sair">
                    <i data-lucide="power"></i>
                    <span class="v2-nav-text">Sair</span>
                </a>
            </nav>
        </aside>

        <!-- CONTENT -->
        <div class="v2-content">
            <!-- HEADER -->
            <header class="v2-header">
                <div class="v2-header-left">
                    <h1 class="v2-header-title">Informações</h1>
                    <p class="v2-header-subtitle">Bem-Vindo(a) | VigilaCore</p>
                </div>
                <div class="v2-header-right">
                    <div id="v-conn" class="v2-status-pill offline">SISTEMA OFFLINE</div>
                    <div class="v2-clock-widget">
                        <div class="v2-time-display" id="v-clock-val">--:--</div>
                        <div class="v2-date-display" id="v-date">--/--/----</div>
                    </div>
                </div>
            </header>

            <!-- MAIN CONTENT -->
            <main class="v2-main">
            </main>

            <!-- FOOTER -->
            <footer class="v2-footer">
                <span>VigilaCore  | Desenvolvimento Operacional Estratégico</span>
                <span>Sistema em desenvolvimento</span>
            </footer>
        </div>
    </div>

    <script>
        // Proteção de rota
        (function() {
            const user = localStorage.getItem('vigilacore_user');
            if (!user) {
                window.location.href = 'login.html';
            }
        })();

        lucide.createIcons();
        let chartEntradas, chartResolucoes;

        // Atualizar relógio
        setInterval(() => {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('v-clock-val').innerText = `${hours}:${minutes}`;
            document.getElementById('v-date').innerText = now.toLocaleDateString('pt-BR');
        }, 1000);
        
            function checkSystemStatus() {
            const pill =
                document.getElementById("v2-conn") ||
                document.getElementById("v-conn");

            if (!pill) return; // não existe pill nesta página

            const host = window.location.hostname || "127.0.0.1";
            const dateParam = encodeURIComponent(new Date().toISOString().slice(0, 10));

            const endpoints = [
                `http://${host}:5000/api/status/releitura?date=${dateParam}`,
                `http://${host}:5000/api/status/porteira?date=${dateParam}`,
            ];

            const requests = endpoints.map((url) =>
                fetch(url, { cache: "no-store" }).then((res) => {
                if (!res.ok) throw new Error("offline");
                return true;
                })
            );

            Promise.allSettled(requests).then((results) => {
                const anyOnline = results.some((r) => r.status === "fulfilled");

                if (anyOnline) {
                pill.innerText = "SISTEMA ONLINE";
                pill.className = "v2-status-pill online";
                } else {
                pill.innerText = "SISTEMA OFFLINE";
                pill.className = "v2-status-pill offline";
                }
            });
            }

            setInterval(checkSystemStatus, 5000);
            checkSystemStatus();

    </script>
</body>
</html>
